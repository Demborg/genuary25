<!DOCTYPE html>

<script>

    function rand(min, max) {
        return Math.random() * (max - min) + min
    }

    function mean(a, b) {
        return 0.5 * (a + b)
    }

    function rand2(min, max) {
        return mean(rand(min, max), rand(min, max))
    }

    function map(s, a, b) {
        return s * a + (1-s) * b
    }

    const size = 400



    function onion(svg) {
        const topRadius = rand(0, 50)
        const bulbRadius = rand(topRadius * 2, size / 2 - 25)
        const top = 50
        const bottom = 300
        const bulbHeight = rand2(mean(top, bottom), bottom)
        const smooth = rand(50, 50)
        const lift = rand(0, 20)

        const layers = bulbRadius / 10
        const mid = size / 2

        const hue = rand(0, 360)
        const bg = `hsl(${180 - hue}, 100%, 95%)`
        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        rect.setAttribute("height", "100%")
        rect.setAttribute("width", "100%")
        rect.setAttribute("fill", bg)
        svg.appendChild(rect)
    
        for (let s = 1; s > 0.01; s -= 1/layers) {
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');

            b = bottom - lift * (1- s)

            data = `
                M ${mid - s * topRadius} ${top}
                C ${mid - s * topRadius} ${top + smooth} ${mid - s * bulbRadius} ${bulbHeight - smooth} ${mid - s * bulbRadius} ${bulbHeight}
                S ${mid - s * smooth} ${b} ${mid} ${b}
                S ${mid + s * bulbRadius} ${bulbHeight + smooth} ${mid + s * bulbRadius} ${bulbHeight}
                S ${mid + s * topRadius} ${top + smooth} ${mid + s * topRadius} ${top}
            `

            path.setAttribute("d", data)
            path.setAttribute("stroke", `hsl(${hue}, 76%, ${map(s, 20, 100)}%)`)
            path.setAttribute("fill", "white")

            svg.appendChild(path)
        }
    }

    function run() {
        svgs = document.getElementsByTagName("svg")
        for (let i = 0; i < svgs.length; i++){
            onion(svgs.item(i))
        }
    }

    window.onload = run

</script>

<body>
    <svg height="400" width="400" id="svg"></svg>
    <svg height="400" width="400" id="svg"></svg>
    <svg height="400" width="400" id="svg"></svg>
    <svg height="400" width="400" id="svg"></svg>
</body>