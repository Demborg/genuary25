<!DOCTYPE html>
<script>
    function randomAffine() {
        const theta = Math.random() * 2 * Math.PI
        const dx = (Math.random() * 2 - 1)
        const f = Math.random() * 0.5 +0.4
        const c = Math.cos
        const s = Math.sin
        return (p) => {
            const X = c(theta) * f * p[0] - s(theta) * f * p[1] + dx
            const Y = s(theta) * f * p[0] + c(theta) * f * p[1]
            return [X, Y]
        }
    }
    fs = [randomAffine(), randomAffine(), randomAffine()]
    pr = [0.5, 1]
    dir = -1
    function run() {
        const ctx = document.getElementById("c").getContext("2d")
        ctx.fillStyle = `rgba(50, 50, 50, 0.9)`
        ctx.fillRect(0, 0, 400, 400)
        ps = []
        for(var i = 0; i < 10000; i++) {
            var p = [0, 0, 0, 0, 0]
            for(var j = 0; j < 17; j++) {
                const r = Math.random()
                if (r < pr[0]) p = [...fs[0]([p[0], p[1]]), p[2] + 1, p[3], p[4]] 
                else if (r < pr[1]) p = [...fs[1]([p[0], p[1]]), p[2], p[3] + 1, p[4]]
                else p = [...fs[2]([p[0], p[1]]), p[2], p[3], p[4] + 1]
            }
            ps.push(p)
        }
        ps.forEach(p => {
            const cs = Math.max(p[2], p[3], p[4]) / 255
            ctx.fillStyle = `rgba(${p[2]/cs}, ${p[3]/cs}, ${p[4]/cs}, 0.5)`
            ctx.fillRect(400 * (p[0] + 2) / 4, 400 * (p[1] + 2) / 4, 2, 2)
        });
        pr[0] -= dir * 0.005
        pr[1] -= dir * 0.005
        if (pr[0] < 0) {fs[0] = randomAffine(); dir *= -1}
        if (pr[1] > 1) {fs[2] = randomAffine(); dir *= -1}
        requestAnimationFrame(run)
    }
    window.onload = run
</script>
<body onclick="run()">
    <canvas id="c" height="400", width="400"></canvas>
</body>